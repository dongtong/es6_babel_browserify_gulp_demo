!function t(o,e,n){function i(r,a){if(!e[r]){if(!o[r]){var c="function"==typeof require&&require;if(!a&&c)return c(r,!0);if(s)return s(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=e[r]={exports:{}};o[r][0].call(u.exports,function(t){var e=o[r][1][t];return i(e?e:t)},u,u.exports,t,o,e,n)}return e[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)i(n[r]);return i}({1:[function(t,o,e){"use strict";var n=t("./controllers/todos_ctrl");!function(){var t=new n.TodosCtrl;t.initList()}()},{"./controllers/todos_ctrl":4}],2:[function(t,o,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={RETRY_TIMES:3,TIME_OUT:3e3,ERR_CODE:{ONE:"1",TWO:"2"}};e.Const=n},{}],3:[function(t,o,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t("./const"),i={ajaxReq:function(t){function o(){$.ajax({type:t.type||"GET",url:t.url,data:t.data||{},cache:!1,timeout:n.Const.TIME_OUT,crossDomain:!0,dataType:"jsonp",jsonpCallback:t.jsonpCallback||null,contentType:"application/json;utf-8",success:function(o,e,n){"function"==typeof t.successFn&&t.successFn(o)},error:function(o,e,n){"timeout"===e||t.observeRes()||("function"==typeof t.errorFn?t.errorFn():i.redirectToErr("0"))},complete:function(n,s){"timeout"!==s||t.observeRes()||((void 0===t.retry||t.retry)&&e>0?(e-=1,o()):t.timeoutFn?t.timeoutFn():i.redirectToErr("1"))}})}var e=n.Const.RETRY_TIMES;o()},redirectToErr:function(t){switch(t){case n.Const.ERR_CODE.ONE:console.error("timeout error");break;case n.Const.ERR_CODE.TWO:console.error("timeout error");break;default:console.error("other error")}}};e.Util=i},{"./const":2}],4:[function(t,o,e){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,o){for(var e=0;e<o.length;e++){var n=o[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(o,e,n){return e&&t(o.prototype,e),n&&t(o,n),o}}(),r=(t("../models/todo"),t("../common/util")),a=t("../views/todos/edit"),c=n(a),l=function(){function t(){i(this,t),window.todosNS=window.todosNs||{}}return s(t,[{key:"initList",value:function(){var t=!1,o=this;o.observeNew(),todosNS.gotTodos=function(e){t=!0,e.data.length?(e.data.map(function(t){$(".todos-list").append('<li data-id="'+t.id+'"><span>'+t.content+'</span><span class="actions"><span class="action edit glyphicon glyphicon-pencil" id="eidt_'+t.id+'"></span><span class="action remove glyphicon glyphicon-remove" id="remove_'+t.id+'"></span></span></li>')}),o.observeTodoList()):$(".todos-list").append("<li>没有待办事项...</li>")},r.Util.ajaxReq({url:"http://localhost:3000/api/v2/todos",jsonpCallback:"todosNS.gotTodos",observeRes:function(){return t}})}},{key:"observeTodoList",value:function(){var t=this;$(".todos-list li").on("mouseover",function(){$(this).find(".actions").show()}).on("mouseout",function(){$(this).find(".actions").hide()}),$(".todos-list").on("click",".edit",function(){t.edit({id:$(this).attr("id"),value:$(this).parent().prev().text()})}).on("click",".remove",function(){t.remove($(this).attr("id").split("_")[1])})}},{key:"observeNew",value:function(){var t=this;$("form").on("submit",function(o){return o.preventDefault(),t.create($("#new_todo").val()),!1})}},{key:"create",value:function(t){var o=this,e=!1;todosNS.addedTodo=function(t){if(e=!0,t.success){$("#new_todo").val("");var n='<li data-id="'+t.id+'"><span>'+t.content+'</span><span class="actions"><span class="action edit glyphicon glyphicon-pencil" id="eidt_'+t.id+'"></span><span class="action remove glyphicon glyphicon-remove" id="remove_'+t.id+'"></span></span></li>';$(".todos-list span").length?$(".todos-list").append(n):$(".todos-list").html(n),o.observeAddedItem()}else alert("添加失败!")},r.Util.ajaxReq({url:"http://localhost:3000/api/v2/todos/add?content="+t,jsonpCallback:"todosNS.addedTodo",observeRes:function(){return e}})}},{key:"observeAddedItem",value:function(){$(".todos-list li:last-child").on("mouseover",function(){$(this).find(".actions").show()}).on("mouseout",function(){$(this).find(".actions").hide()}).on("click",".edit",function(){$this.edit({id:$(this).attr("id"),value:$(this).parent().prev().text()})}).on("click",".remove",function(){$this.remove($(this).attr("id").split("_")[1])})}},{key:"edit",value:function(t){var o=this,e=$("#"+t.id).parents("li");e.html((0,c["default"])(t)).find("input").on("keyup",function(n){var i=$(this).val();13==n.which&&o.update({url:"http://localhost:3000/api/v2/todos/"+t.id.split("_")[1]+"/update?content="+encodeURIComponent(i),done:function(t){t.success?e.html("<span>"+t.content+'</span><span class="actions"><span class="action edit glyphicon glyphicon-pencil" id="eidt_'+t.id+'"></span><span class="action remove glyphicon glyphicon-remove" id="remove_'+t.id+'"></span></span>'):alert("更新失败")}})})}},{key:"update",value:function(t){var o=!1;todosNS.updatedTodo=function(e){o=!0,t.done(e)},r.Util.ajaxReq({type:"PATCH",url:t.url,jsonpCallback:"todosNS.updatedTodo",observeRes:function(){return o}})}},{key:"remove",value:function(t){var o=!1,e=$("#remove_"+t).parents("li");todosNS.removedTodo=function(t){o=!0,t.success?1==$(".todos-list li").length?e.replaceWith("<li>没有待办事项...</li>"):e.remove():alert("删除失败!")},r.Util.ajaxReq({url:"http://localhost:3000/api/v2/todos/"+t+"/delete",jsonpCallback:"todosNS.removedTodo",observeRes:function(){return o}})}}]),t}();e.TodosCtrl=l},{"../common/util":3,"../models/todo":5,"../views/todos/edit":6}],5:[function(t,o,e){"use strict";function n(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function s(){n(this,s)};e.Todo=i},{}],6:[function(t,o,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=function(t){return'<input id="'+t.id+'_input" class="edit_input" value="'+t.value+'"></input>'},o.exports=e["default"]},{}]},{},[1]);